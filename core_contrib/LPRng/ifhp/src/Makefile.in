#**************************************************************************
#* LPRng IFHP Filter
#* Copyright 1994-1999 Patrick Powell, San Diego, CA <papowell@astart.com>
#*
#* $Id: Makefile.in,v 1.17 2000/04/19 01:37:02 papowell Exp papowell $
#

SRC=@srcdir@
@SET_MAKE@
prefix=@prefix@
exec_prefix=@exec_prefix@
sysconfdir=@sysconfdir@
libexecdir=@libexecdir@
INSTALLCMD=@INSTALL@
FILTERDIR=@FILTERDIR@
CONFIG_FILE=@CONFIG_FILE@
CC      = @CC@
CFLAGS := @CFLAGS@
LDFLAGS:= @LDFLAGS@
# add additional definitions here
DEFS=@DEFS@

# libraries you will need (found by config), add more to end
LIBS=@LIBS@

INSTALLCMD=@INSTALL@
RANLIB=@RANLIB@

######### - no changes by configure after here #############


#=============================================================================
# List the directories you want to generate:
# DIRS for all, clean, etc.
# ALLDIRS for other such as documentation
#=============================================================================

SRCDIRS=${SRC}/.
INCLUDE=.. ${SRC}/.

#GNU
ifeq ($(FILTERDIR),)
FILTERDIR=${libexecdir}/filters
endif
ifeq ($(CONFIG_FILE),)
CONFIG_FILE=${sysconfdir}/ifhp.conf
endif
CFLAGS:= $(CFLAGS) -DCONFIG_FILE=\"$(CONFIG_FILE)\"
VPATH=$(subst :, ,$(INCLUDE) $(SRCDIRS))
INCS=$(patsubst %,-I%,$(INCLUDE))

#BSD
#BSD .if $(FILTERDIR) == ""
#BSD FILTERDIR=${libexecdir}/filters
#BSD .endif
#BSD .if $(CONFIG_FILE) == ""
#BSD CONFIG_FILE=${sysconfdir}/ifhp.conf
#BSD .endif
#BSD CFLAGS:= $(CFLAGS) -DCONFIG_FILE=\"$(CONFIG_FILE)\"
#BSD .PATH: $(INCLUDE) $(SRCDIRS)
#BSD INCS= $(INCLUDE:S/^/-I/g)

# Accounting shell location
# ACCNTSH= -DACCNTSH=\"$(FILTERDIR)/accounting.sh\"


CFLAGS:= $(CFLAGS) $(INCS) $(DEFS)


# commands
INSTALL= accounting.sh wrapper
COMMANDS= ifhp textps

all: ${COMMANDS} ${INSTALL}

.PHONY: all clean install

#
# Object - Source  dependencies
#

OBJS= ifhp.o accounting.o vars.o errormsg.o plp_snprintf.o globmatch.o \
	open_device.o stty.o checkcode.o linelist.o

ifhp:	$(OBJS)
	${CC} ${LDFLAGS} $^ ${LIBS} -o $@

$(OBJS): Makefile Makefile.bsd

monitor.o $(OBJS): debug.h errormsg.h ifhp.h portable.h \
	patchlevel.h config.h linelist.h

monitor: monitor.o plp_snprintf.o
	${CC} ${LDFLAGS} $^ ${LIBS} -o $@

textps: textps.o
	${CC} ${LDFLAGS} $^ ${LIBS} -o $@

#
# Installation of commands
#

install: all
	if [ ! -d $(FILTERDIR) ] ; then ${SRC}/mkinstalldirs $(FILTERDIR); fi;
	for i in $(COMMANDS) ; do \
		$(INSTALLCMD) -s -m 755 $$i $(FILTERDIR); \
	done ;
	for i in $(INSTALL) ; do \
		$(INSTALLCMD) -m 755 $$i $(FILTERDIR)/`basename $$i`; \
	done ;
	cd $(FILTERDIR); rm -f ofhp banner; \
		ln -s ifhp ofhp; ln -s ifhp banner
#
# Miscellaneous
#

clean:
	-rm -f $(COMMANDS) *.o *.a *.core core ? tags banner ofhp accounting.sh

CI=
#CO=-kv
CO=-l
ci: 
	if test ! -d RCS ; then mkdir RCS; fi;
	checkin() { \
		rcs -l $$1; \
		ci $(CI) -mUpdate -t-Initial $$1; \
		co $(CO) $$1; \
	}; \
	for i in *.[ch] Makefile* *.sh_init *.ps *.conf; \
		do \
		if [ -f $$i ]; then checkin $$i; fi; \
	done;

distclean: clean
	-rm -f Makefile Makefile.bsd *.bak *.orig *.rej

TAGS:
	ctags *.c *.h
