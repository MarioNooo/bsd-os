.\"	BSDI boot_sparc.8,v 2.4 1998/09/22 13:06:25 torek Exp
.\"
.\" Copyright (c) 1992, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @(#)boot_sparc.8	8.2 (Berkeley) 4/19/94
.\"
.Dd September 22, 1998
.Dt REBOOT 8 sparc
.Os
.Sh NAME
.Nm boot
.Nd
system bootstrapping procedures
.Sh DESCRIPTION
.Sy Power fail and crash recovery.
Normally, the system will reboot itself at power-up or after crashes.
An automatic consistency check of the file systems will be performed
as described in
.Xr fsck 8 .
and unless this fails, the system will resume multi-user operations.
.Pp
.Sy Cold starts
The
.Tn SPARC
system provides a configurable bootstrap procedure
whose details depend on the specific revision of the ``OpenBoot'' system
installed in the machine.
Typically, the
.Tn PROM
has a ``boot-device'' set to ``disk'', a ``boot-file'' set to nothing,
and the ``auto-boot?'' parameter set to ``true''.
These can be changed at the
.Tn PROM
``ok'' prompt (enter ``printenv'' and ``help setenv''), or via
.Xr eeprom 8 .
These boot devices are actually aliases;
use the ``devalias'' command to display all the aliases,
and the ``show-devs'' command to display the devices.
Note that all names beginning with a slash name a ``device''
while other names are treated as either aliases or filenames.
(The OpenBoot
.Tn PROM
provides no syntax to distinguish between an alias and a filename,
so making aliases that match bootable file names, or vice versa,
is generally unwise.)
Older systems may use a single parameter
and/or names of the form ``sd(0,0,0)bsd''.
.Pp
Note that versions of the
.Tn PROM
for
.Tn SPARC
machines that predate the
.Tn UltraSPARC
map
.Tn SCSI
target 3 to ``disk 0'' and
.Tn SCSI
target 0 to ``disk 3''.
(It is also generally advisable to turn off ``sunmon-compat?''
on these systems,
to obtain access to all of the
.Tn PROM
commands.)
.Pp
When booting off a disk (including floppy and CD-ROM), the
.Tn SPARC
hardware loads the disk's boot block (see
.Xr disksetup 8 )
into memory.
The boot block then uses the
.Tn PROM
drivers to load
.Pa /boot
(or
.Pa /boot.v9
on
.Tn UltraSPARC )
from the same disk and partition.
By default,
.Pa /boot
will then load and run the specified boot file
from the same disk and partition.
If no boot file is named,
.Pa /boot
defaults to
.Pa bsd .
.Pp
The bootstrap can be interrupted
via the console keyboard L1-A (abort) command,
or for machines with a serial console,
by asserting a BREAK condition.
Alternative boot commands may then be entered at the ``ok'' prompt,
such as:
.Bl -tag -width bootxdisk2x-sxxx -offset indent
.It Li "boot disk2 -s"
boot single user from SCSI target 2
.It Li "boot -a"
prompt for a boot device and kernel
.El
.Pp
When booting off of a network device,
the 
.Tn SPARC
hardware begins by broadcasting a reverse arp request (see
.Xr rarpd 8 ),
then uses the TFTP protocol (see
.Xr tftpd 8 )
to load a second-level bootstrap.
The
.Tn BSD/OS
``netboot'' bootstrap then uses the BOOTP protocol
to find an NFS server,
mounts the server's root file system,
and boots the specified kernel (default ``bsd'').
Note that rarpd, tftpd, and bootp must all be configured
to use this style of diskless booting.
For rarpd to respond, the
.Pa /tftpboot
directory must contain a file whose name is the IP address of the client,
in uppercase hexadecimal.
The
.Tn PROM
TFTP bootstrap uses a similar file name;
sometimes it appends
.Li \&.SUN4C
or
.Li \&.SUN4M ,
depending on the hardware type.
The recommended configuration (for tighter security)
is to run tftpd with /tftpboot as its search directory,
copy or (hard) link /stand/netboot to /tftpboot/netboot,
and make these files as links
(hard or symbolic) to the ``netboot''
or ``netboot.v9'' bootstrap as appropriate.
The prom may also prepend the path
.Pa /tftpboot/
to its request; to handle this, make sure that
.Pa /tftpboot/tftpboot
is a symbolic link to
.Dq \&. .
.Sh EXAMPLE
To set up network booting for a sun4m client machine named
.Dq client.com
at Ethernet address 8:0:20:21:11:22
and IP address 127.18.2.1, with NFS server
.Dq server.com
serving
.Pa /export/client/root
and
.Pa /export/client/swap,
.Pa /etc/ethers
would have to contain the line:
.Pp
.Dl 08:00:20:21:11:22    client.com
.Pp
The
.Pa /etc/bootptab
file might contain the lines:
.Bd -literal -offset indent
\&.default:  :hn:ht=ethernet:
client:    :ha=080020211122:ip=127.18.2.1:\e
           :rp=/export/client/root:tc=.default:
.Ed
.Pp
(here bootpd is assumed to be running on the NFS server;
otherwise, add
.Dq :sa=server.com:
to redirect the NFS requests).
The commands:
.Bd -literal -offset indent -unfilled
cd /tftpboot
ln /stand/netboot .
ln -s . tftpboot
ln -s netboot 7F120201
ln -s netboot 7F120201.SUN4M
.Ed
.Pp
would then set up the
.Pa /tftpboot
directory.
.Sh FILES
.Bl -tag -width /tftpboot/netbootxxx -compact
.It Pa /bsd
system code
.It Pa /boot
local bootstrap (pre-V9)
.It Pa /boot.v9
local bootstrap (V9)
.It Pa /tftpboot/netboot
network bootstrap (pre-V9)
.It Pa /tftpboot/netboot.v9
network bootstrap (V9)
.It Pa /tftpboot/tftpboot
symbolic link for old
.Tn PROMs
.El
.Sh SEE ALSO
.Xr bootptab 5 ,
.Xr bootpd 8 ,
.Xr crash 8 ,
.Xr disklabel 8 ,
.Xr fsck 8 ,
.Xr halt 8 ,
.Xr inetd 8 ,
.Xr init 8 ,
.Xr rc 8 ,
.Xr shutdown 8 ,
.Xr syslogd 8 ,
.Xr tftpd 8
